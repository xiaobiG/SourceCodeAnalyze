# 渲染操作

应用将图片和文字渲染到屏幕上的流畅度会直接影响用户对质量的感知。

### 减少过度绘制
尽可能减少应用在单帧中重新绘制同一像素的次数。

### 性能与视图层次结构
确保您的布局和测量值能够高效执行，并避免 Double Taxation。

### 使用 GPU 渲染模式分析工具进行分析
利用该设备端工具找出可能减慢应用渲染速度的瓶颈。

# 减少过度绘制 

应用可能会在单个帧内多次绘制同一个像素，这种情况称为“过度绘制”。

例如，如果我们有若干界面卡片堆叠在一起，每张卡片都会遮盖其下面一张卡片的部分内容。

过度绘制通常是不必要的，最好避免。它会浪费 GPU 时间来渲染与用户在屏幕上所见内容无关的像素，进而导致性能问题。

> 注意：过度绘制的问题在 Google I/O 大会性能会议和性能模式视频中讨论过，这个问题现在已没有当时那么严重了。这是因为低端设备的 GPU 性能不断提升，而其显示屏的分辨率保持在了一个相对较低的水平。除非是要针对已知的低性能 GPU 设备进行优化，否则建议将重点放在优化界面线程工作上，以确保应用性能稳定。除此之外，在很多情况下，操作系统优化可以避免应用内的过度绘制（例如，Fragment 背景过度绘制窗口背景）。

## 移除布局中不需要的背景
默认情况下，布局没有背景，这表示布局本身不会直接渲染任何内容。但是，当布局具有背景时，其有可能会导致过度绘制。

移除不必要的背景可以快速提高渲染性能。不必要的背景可能永远不可见，因为它会被应用在该视图上绘制的任何其他内容完全覆盖。例如，当系统在父视图上绘制子视图时，可能会完全覆盖父视图的背景。

如需查找过度绘制的原因，请在布局检查器工具中浏览层次结构。在浏览过程中，请留意您可以移除的背景，因为它们对用户不可见。在许多容器采用同一种背景颜色的情况下，您也有机会移除不需要的背景：您可以将窗口背景设置为应用的主背景颜色，并且不为其上面的任何容器定义背景值。

## 使视图层次结构扁平化
借助先进的布局设计方法，您可以轻松对视图进行堆叠和分层，从而打造出精美的设计。但是，这样做会导致过度绘制，从而降低性能，特别是在每个堆叠视图对象都是不透明的情况下，这需要将可见和不可见的像素都绘制到屏幕上。

如果遇到这类问题，您可以通过优化视图层次结构来减少重叠界面对象的数量，从而提高性能。如需详细了解如何实现此操作，请参阅优化视图层次结构。

## 降低透明度
在屏幕上渲染透明像素，即所谓的透明度渲染，是导致过度绘制的重要因素。在普通的过度绘制中，系统会在已绘制的现有像素上绘制不透明的像素，从而将其完全遮盖，与此不同的是，透明对象需要先绘制现有的像素，以便达到正确的混合效果。诸如透明动画、淡出和阴影之类的视觉效果都会涉及某种透明度，因此有可能导致严重的过度绘制。您可以通过减少要渲染的透明对象的数量，来改善这些情况下的过度绘制。例如，如需获得灰色文本，您可以在 TextView 中绘制黑色文本，再为其设置半透明的透明度值。但是，您可以简单地通过用灰色绘制文本来获得同样的效果，而且能够大幅提升性能。